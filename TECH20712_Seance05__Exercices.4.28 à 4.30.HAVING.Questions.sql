/*
	Fichier créé par Edouard Labbé et Bogdan Negoita

	HEC Montréal, Gestion des bases de données
	Séance 2, Exercices 4.28 à 4.30
*/

/*******************************************************************/
USE AdventureWorks2019;
GO


--Exercice 4.28 Sélectionner la somme des ventes d’AdventuresWorks en 2013 par territoire pour les territoires dont la moyenne des ventes en 2013 est inférieure ou égale à 3000$

SELECT 
	  TerritoryID
	, AVG(TotalDue) AS 'Average'
FROM Sales.SalesOrderHeader
WHERE OrderDate BETWEEN '2013-01-01' AND '2013-12-31'	--OU YEAR(OrderDate)='2013'
GROUP BY TerritoryID
HAVING AVG(TotalDue) < 3000



--Exercice 4.29 La somme totale des ventes, avec regroupement selon le territoire et le vendeur associé à la vente (simplement les ID)
--					pour les vendeurs ayant fait plus de 100 ventes (toujours par territoire) ou 
--					pour les vendeurs ayant fait moins de 5 ventes(toujours par territoire)
--					dans 1 seule requête.

SELECT 
	  TerritoryID
	, SalesPersonID
	, COUNT(*)		AS NombreDeVentes
	, SUM(TotalDue) AS Somme
FROM Sales.SalesOrderHeader
WHERE SalesPersonID IS NOT NULL
GROUP BY TerritoryID, SalesPersonID
HAVING COUNT(*) > 100 OR COUNT(*) < 5


--Exercice 4.30 Sélectionner la somme de toutes les ventes d’AdventuresWorks par territoire pour les territoires ayant vendus plus de 10M$


SELECT 
	  TerritoryID
	, SUM(TotalDue) AS Somme
FROM Sales.SalesOrderHeader
GROUP BY TerritoryID
HAVING SUM(TotalDue) > 10000000



